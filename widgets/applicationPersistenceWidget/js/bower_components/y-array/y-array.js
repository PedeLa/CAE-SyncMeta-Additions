!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){var t=function(t){function n(t,o,a){r(this,n);var s=i(this,Object.getPrototypeOf(n).call(this));return s.os=t,s._model=o,s._content=a,s.eventHandler=new e.utils.EventHandler(function(t){if("Insert"===t.struct){var n=void 0;if(null===t.left)n=0;else if(n=1+s._content.findIndex(function(n){return e.utils.compareIds(n.id,t.left)}),0>=n)throw new Error("Unexpected operation!");var r=s._content[n];if(null!=r&&e.utils.compareIds(r.id,t.id))return;var i,o;if(t.hasOwnProperty("opContent"))s._content.splice(n,0,{id:t.id,type:t.opContent}),o=1,i=[s.os.getType(t.opContent)];else{var a=t.content.map(function(e,n){return{id:[t.id[0],t.id[1]+n],val:e}});s._content.splice.apply(s._content,[n,0].concat(a)),i=t.content,o=t.content.length}s.eventHandler.callEventListeners({type:"insert",object:s,index:n,values:i,length:o})}else{if("Delete"!==t.struct)throw new Error("Unexpected struct!");for(var u=0;u<s._content.length&&t.length>0;u++){var l=s._content[u];if(e.utils.inDeletionRange(t,l.id)){var c;for(c=1;c<t.length&&u+c<s._content.length&&e.utils.inDeletionRange(t,s._content[u+c].id);c++);l=s._content[u+c-1],t.length-=l.id[1]-t.target[1]+1,t.target=[l.id[0],l.id[1]+1];var f=s._content.splice(u,c),p=f.map(function(e){return null!=e.val?e.val:s.os.getType(e.type)});s.eventHandler.callEventListeners({type:"delete",object:s,index:u,values:p,_content:f,length:c})}}}}),s}return o(n,t),s(n,[{key:"_destroy",value:function(){this.eventHandler.destroy(),this.eventHandler=null,this._content=null,this._model=null,this.os=null}},{key:"get",value:function(e){if(null==e||"number"!=typeof e)throw new Error("pos must be a number!");return e>=this._content.length?void 0:null==this._content[e].type?this._content[e].val:this.os.getType(this._content[e].type)}},{key:"toArray",value:function(){var e=this;return this._content.map(function(t,n){return null!=t.type?e.os.getType(t.type):t.val})}},{key:"push",value:function(e){return this.insert(this._content.length,e)}},{key:"insert",value:function(t,n){if("number"!=typeof t)throw new Error("pos must be a number!");if(!(n instanceof Array))throw new Error("contents must be an Array of objects!");if(0!==n.length){if(t>this._content.length||0>t)throw new Error("This position exceeds the range of the array!");for(var r=0===t?null:this._content[t-1].id,i=[],o=r,a=0;a<n.length;){for(var s,u={left:o,origin:o,parent:this._model,struct:"Insert"},l=[];a<n.length;){var c=n[a++];if(s=e.utils.isTypeDefinition(c)){if(l.length>0){a--;break}break}l.push(c)}if(l.length>0)u.content=l,u.id=this.os.getNextOpId(l.length);else{var f=this.os.getNextOpId(1);this.os.createType(s,f),u.opContent=f,u.id=this.os.getNextOpId(1)}i.push(u),o=u.id}var p=this.eventHandler;this.os.requestTransaction(regeneratorRuntime.mark(function h(){var e,t,n,o;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(null==r){a.next=6;break}return a.delegateYield(this.getInsertionCleanEnd(r),"t0",2);case 2:t=a.t0,e=t.right,a.next=8;break;case 6:return a.delegateYield(this.getOperation(i[0].parent),"t1",7);case 7:e=a.t1.start;case 8:for(n=0;n<i.length;n++)o=i[n],o.right=e;return a.delegateYield(p.awaitOps(this,this.applyCreatedOperations,[i]),"t2",10);case 10:case"end":return a.stop()}},h,this)})),p.awaitAndPrematurelyCall(i)}}},{key:"delete",value:function(t,n){if(null==n&&(n=1),"number"!=typeof n)throw new Error("length must be a number!");if("number"!=typeof t)throw new Error("pos must be a number!");if(t+n>this._content.length||0>t||0>n)throw new Error("The deletion range exceeds the range of the array!");if(0!==n){for(var r=this.eventHandler,i=[],o=0;n>o;o+=a){var a,s=this._content[t+o].id;for(a=1;n>o+a&&e.utils.compareIds(this._content[t+o+a].id,[s[0],s[1]+a]);a++);i.push({target:s,struct:"Delete",length:a})}this.os.requestTransaction(regeneratorRuntime.mark(function u(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.delegateYield(r.awaitOps(this,this.applyCreatedOperations,[i]),"t0",1);case 1:case"end":return e.stop()}},u,this)})),r.awaitAndPrematurelyCall(i)}}},{key:"observe",value:function(e){this.eventHandler.addEventListener(e)}},{key:"unobserve",value:function(e){this.eventHandler.removeEventListener(e)}},{key:"_changed",value:regeneratorRuntime.mark(function a(e,t){var n,r;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(t.deleted){i.next=15;break}if("Insert"!==t.struct){i.next=14;break}n=t.left;case 3:if(null==n){i.next=11;break}return i.delegateYield(e.getInsertion(n),"t0",5);case 5:if(r=i.t0,r.deleted){i.next=8;break}return i.abrupt("break",11);case 8:n=r.left,i.next=3;break;case 11:if(t.left=n,null==t.opContent){i.next=14;break}return i.delegateYield(e.store.initType.call(e,t.opContent),"t1",14);case 14:this.eventHandler.receivedOp(t);case 15:case"end":return i.stop()}},a,this)})},{key:"length",get:function(){return this._content.length}}]),n}(e.utils.CustomType);e.extend("Array",new e.utils.CustomTypeDefinition({name:"Array","class":t,struct:"List",initType:regeneratorRuntime.mark(function n(r,i){var o,a,s;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=[],a=[],n.delegateYield(e.Struct.List.map.call(this,i,function(e){e.hasOwnProperty("opContent")?(o.push({id:e.id,type:e.opContent}),a.push(e.opContent)):e.content.forEach(function(t,n){o.push({id:[e.id[0],e.id[1]+n],val:e.content[n]})})}),"t0",3);case 3:s=0;case 4:if(!(s<a.length)){n.next=9;break}return n.delegateYield(this.store.initType.call(this,a[s]),"t1",6);case 6:s++,n.next=4;break;case 9:return n.abrupt("return",new t(r,i.id,o));case 10:case"end":return n.stop()}},n,this)}),createType:function(e,n){return new t(e,n.id,[])}}))}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.exports=a,"undefined"!=typeof Y&&a(Y)},{}]},{},[1]);
//# sourceMappingURL=y-array.js.map
